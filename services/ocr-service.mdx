---
title: OCR Service
description: "Extract structured product information from screenshots using Groq's Llama 4 Vision model."
---

## Overview

The **OCR Service** extracts product information from screenshots using AI vision models. It uses Groq's Llama 4 Maverick model to analyze images and return structured JSON data.

**File**: `app/services/ocr_service.py`

## Function

<ParamField body="analyze_product_screenshot" type="async function">
  Analyzes a base64-encoded image and extracts product information as structured JSON.
</ParamField>

```python
async def analyze_product_screenshot(base64_image: str) -> Optional[dict]
```

<ParamField body="base64_image" type="string" required>
  Base64-encoded JPEG image (from Image Service)
</ParamField>

**Returns**: Dictionary with product information or `None` if extraction fails

## Extracted Fields

<ParamField body="name" type="string" required>
  Product name
</ParamField>
<ParamField body="price" type="float" required>
  Product price (numeric value)
</ParamField>
<ParamField body="currency" type="string" required>
  Currency code (EUR, USD, GBP, etc.)
</ParamField>
<ParamField body="description" type="string">
  Product description
</ParamField>
<ParamField body="merchant" type="string">
  Brand or merchant name
</ParamField>
<ParamField body="category" type="string">
  Product category
</ParamField>
<ParamField body="tags" type="string">
  Comma-separated tags
</ParamField>
<ParamField body="object_type" type="string">
  Type of object (e.g., "leather jacket", "sunglasses")
</ParamField>
<ParamField body="url" type="string">
  Product URL if visible in screenshot
</ParamField>

## Example Response

```json
{
  "name": "UBURN - LA BOISSON VIOLETTE ANTI-FRINGALES",
  "price": 34.5,
  "currency": "EUR",
  "description": "A purple drink product set for weight loss...",
  "merchant": "Not specified",
  "category": "Dietary Supplements",
  "tags": "weight-loss, supplements",
  "object_type": "Dietary Supplement Kit",
  "url": null
}
```

## Implementation

```python
import json
import os
from openai import AsyncOpenAI
from app.core.prompts import PRODUCT_EXTRACTION_SYSTEM_PROMPT

groq_client = AsyncOpenAI(
    api_key=os.getenv("OCR_API_KEY"),
    base_url="https://api.groq.com/openai/v1"
)

async def analyze_product_screenshot(base64_image: str) -> Optional[dict]:
    response = await groq_client.chat.completions.create(
        model="meta-llama/llama-4-maverick-17b-128e-instruct",
        messages=[
            {"role": "system", "content": PRODUCT_EXTRACTION_SYSTEM_PROMPT},
            {
                "role": "user",
                "content": [
                    {
                        "type": "image_url",
                        "image_url": {
                            "url": f"data:image/jpeg;base64,{base64_image}"
                        }
                    }
                ]
            }
        ],
        response_format={"type": "json_object"},
        temperature=0.1
    )
    
    result = json.loads(response.choices[0].message.content)
    return result
```

## Model Configuration

<CardGroup cols={2}>
  <Card title="Model" icon="brain">
    `meta-llama/llama-4-maverick-17b-128e-instruct`
  </Card>
  <Card title="Provider" icon="cloud">
    Groq Cloud
  </Card>
  <Card title="Temperature" icon="thermometer">
    0.1 (for consistent extraction)
  </Card>
  <Card title="Output Format" icon="code">
    JSON Object
  </Card>
</CardGroup>

## Usage Example

```python
from app.services.image_service import prepare_image_for_ocr
from app.services.ocr_service import analyze_product_screenshot

async def process_screenshot(file: UploadFile):
    # Step 1: Convert image
    image_bytes = await file.read()
    base64_image = await prepare_image_for_ocr(
        image_bytes, 
        file.content_type
    )
    
    # Step 2: Extract product data
    ocr_data = await analyze_product_screenshot(base64_image)
    
    if not ocr_data or not ocr_data.get("name"):
        raise ValueError("OCR failed to extract product name")
    
    return ocr_data
```

## Performance

<CardGroup cols={2}>
  <Card title="Average Time" icon="clock">
    3-5 seconds per image
  </Card>
  <Card title="Success Rate" icon="check-circle">
    95%+ (tested on 8+ diverse screenshots)
  </Card>
  <Card title="Supported Sources" icon="mobile-screen">
    Instagram, TikTok, e-commerce, web
  </Card>
  <Card title="Accuracy" icon="target">
    High for clear screenshots
  </Card>
</CardGroup>

## Configuration

Add to your `.env` file:

```bash
OCR_API_KEY=gsk_your_groq_api_key_here
```

Get your API key from: [Groq Console](https://console.groq.com)

## Dependencies

```txt
groq>=0.4.0
openai>=1.0.0  # Used for Groq compatibility
```

Install with:
```bash
pip install groq openai
```

## Error Handling

<Warning>
  The service returns `None` if:
  - API call fails
  - Invalid image format
  - Network errors
  - Rate limiting
  
  In the pipeline, this results in HTTP 422 responses.
</Warning>

## System Prompt

The service uses a carefully crafted system prompt (`PRODUCT_EXTRACTION_SYSTEM_PROMPT`) that instructs the model to:

- Extract structured product information
- Focus on visible text and UI elements
- Return valid JSON format
- Handle missing fields gracefully

<Tip>
  The system prompt is defined in `app/core/prompts.py` and can be customized for your use case.
</Tip>

## Limitations

<AccordionGroup>
  <Accordion title="Image Quality">
    Works best with clear, high-resolution screenshots. Blurry or low-quality images may reduce accuracy.
  </Accordion>

  <Accordion title="Language Support">
    Primarily optimized for English and French. Other languages may have reduced accuracy.
  </Accordion>

  <Accordion title="Complex Layouts">
    Very complex or cluttered screenshots may confuse the model. Simple product pages work best.
  </Accordion>
</AccordionGroup>

## Next Steps

- Learn about the [Crop Service](/services/crop-service) that uses OCR context
- Check the [Search Enrichment](/services/search-enrichment) service that enriches OCR data

